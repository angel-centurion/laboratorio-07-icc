events {
    worker_connections 1024;
}

http {
    upstream proveedores-backend {
        server host.docker.internal:8083;
    }

    upstream productos-backend {
        server host.docker.internal:8082;
    }

    upstream clientes-backend {
        server host.docker.internal:8081;
    }

    server {
        listen 80;

        # P√°gina de inicio
        location = / {
            add_header Content-Type "text/html; charset=utf-8";
            return 200 '
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Laboratorio 07</title>
                    <style>
                        body { font-family: Arial; margin: 40px; background: #f5f5f5; }
                        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; text-align: center; }
                        .app-link { display: inline-block; padding: 15px 25px; margin: 10px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>üöÄ Laboratorio 07 - Sistema CRUD</h1>
                        <a href="/proveedores/" class="app-link">üè¢ Proveedores</a>
                        <a href="/productos/" class="app-link">üì¶ Productos</a>
                        <a href="/clientes/" class="app-link">üë• Clientes</a>
                    </div>
                </body>
                </html>
            ';
        }

        # Clientes - CON REWRITE PARA APIS
        location /clientes/ {
            proxy_pass http://clientes-backend/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Capturar llamadas a /api/clientes y redirigir a /clientes/api/clientes
        location /api/clientes {
            rewrite ^/api/clientes(.*)$ /clientes/api/clientes$1 break;
            proxy_pass http://clientes-backend;
        }

        # Productos - CON REWRITE PARA APIS
        location /productos/ {
            proxy_pass http://productos-backend/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /api/productos {
            rewrite ^/api/productos(.*)$ /productos/api/productos$1 break;
            proxy_pass http://productos-backend;
        }

        # Proveedores - CON REWRITE PARA APIS
        location /proveedores/ {
            proxy_pass http://proveedores-backend/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /api/proveedores {
            rewrite ^/api/proveedores(.*)$ /proveedores/api/proveedores$1 break;
            proxy_pass http://proveedores-backend;
        }
    }
}